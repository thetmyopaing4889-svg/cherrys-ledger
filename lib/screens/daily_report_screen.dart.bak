import 'package:flutter/material.dart';

class DailyReportScreen extends StatefulWidget {
  final String bossId;
  final String bossName;

  const DailyReportScreen({
    super.key,
    required this.bossId,
    required this.bossName,
  });

  @override
  State<DailyReportScreen> createState() => _DailyReportScreenState();
}

class _DailyReportScreenState extends State<DailyReportScreen> {
  DateTime selectedDate = DateTime.now();

  // ðŸ”¥ Demo Transactions (later Firestore/local á€™á€¾ load á€™á€šá€º)
  final List<Map<String, dynamic>> depositTx = [
    {
      "name": "Vis",
      "desc": "KBZ Pay",
      "amount": 10000000,
      "commission": 0,
    },
  ];

  final List<Map<String, dynamic>> withdrawTx = [
    {
      "name": "Ko Aung",
      "desc": "Cash Out",
      "amount": 200000,
      "commission": 200,
    },
    {
      "name": "Su Su",
      "desc": "WavePay",
      "amount": 500000,
      "commission": 500,
    },
  ];

  int totalKs(Map<String, dynamic> tx) {
    return (tx["amount"] as int) + (tx["commission"] as int);
  }

  @override
  Widget build(BuildContext context) {
    // Totals
    final depositTotal =
        depositTx.fold<int>(0, (sum, tx) => sum + totalKs(tx));
    final withdrawTotal =
        withdrawTx.fold<int>(0, (sum, tx) => sum + totalKs(tx));

    // Counts
    final depositCount = depositTx.length;
    final withdrawCount = withdrawTx.length;
    final totalCount = depositCount + withdrawCount;

    // Balance Demo
    final previousBalance = 0;
    final subtotal = previousBalance + depositTotal;
    final closingBalance = subtotal - withdrawTotal;

    return Scaffold(
      backgroundColor: const Color(0xFFFFF5F7),
      appBar: AppBar(
        backgroundColor: Colors.white,
        title: Text(
          "${widget.bossName} Daily Report",
          style: const TextStyle(fontWeight: FontWeight.w800),
        ),
      ),
      body: ListView(
        padding: const EdgeInsets.all(16),
        children: [
          // Date Picker
          _card(
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text(
                  "Date: ${selectedDate.day}/${selectedDate.month}/${selectedDate.year}",
                  style: const TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w700,
                  ),
                ),
                IconButton(
                  icon: const Icon(Icons.calendar_month),
                  onPressed: () async {
                    final picked = await showDatePicker(
                      context: context,
                      initialDate: selectedDate,
                      firstDate: DateTime(2020),
                      lastDate: DateTime(2100),
                    );
                    if (picked != null) {
                      setState(() => selectedDate = picked);
                    }
                  },
                )
              ],
            ),
          ),

          const SizedBox(height: 18),

          // Deposit Section
          _sectionTitle("DEPOSIT", Colors.green),
          _txTable(depositTx, Colors.green),
          _totalRow("+${depositTotal.toString()} MMK", Colors.green),

          const SizedBox(height: 18),

          // Withdraw Section
          _sectionTitle("WITHDRAW", Colors.red),
          _txTable(withdrawTx, Colors.red),
          _totalRow("-${withdrawTotal.toString()} MMK", Colors.red),

          const SizedBox(height: 18),

          // Balance Summary
          _card(
            child: Column(
              children: [
                _balanceLine("Previous Balance", previousBalance),
                _balanceLine("(+) Total Deposit", depositTotal),
                _balanceLine("Subtotal", subtotal),
                _balanceLine("(-) Total Withdraw", withdrawTotal),
                const Divider(),
                _balanceLine("Closing Balance", closingBalance,
                    bold: true),
              ],
            ),
          ),

          const SizedBox(height: 18),

          // âœ… Count Summary
          _card(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                const Text(
                  "Daily Count Summary",
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w800,
                  ),
                ),
                const SizedBox(height: 10),
                Text("Deposit á€…á€±á€¬á€„á€ºá€›á€± ( $depositCount )"),
                Text("Withdraw á€…á€±á€¬á€„á€ºá€›á€± ( $withdrawCount )"),
                Text("Total á€…á€±á€¬á€„á€ºá€›á€± ( $totalCount )"),
              ],
            ),
          ),
        ],
      ),
      ),
    );
  }

  Widget _sectionTitle(String text, Color color) {
    return Text(
      text,
      style: TextStyle(
        fontSize: 18,
        fontWeight: FontWeight.w900,
        color: color,
      ),
      ),
    );
  }

  Widget _txTable(List<Map<String, dynamic>> list, Color color) {
    return _card(
      child: Column(
        children: list.map((tx) {
          return Padding(
            padding: const EdgeInsets.symmetric(vertical: 6),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Expanded(child: Text(tx["name"])),
                Expanded(child: Text(tx["desc"])),
                Text("${tx["amount"]}"),
                const SizedBox(width: 8),
                Text("${tx["commission"]}"),
                const SizedBox(width: 8),
                Text(
                  "${totalKs(tx)}",
                  style: TextStyle(
                    fontWeight: FontWeight.bold,
                    color: color,
                  ),
                ),
              ],
            ),
          );
        }).toList(),
      ),
      ),
    );
  }

  Widget _totalRow(String text, Color color) {
    return Align(
      alignment: Alignment.centerRight,
      child: Text(
        text,
        style: TextStyle(
          fontSize: 18,
          fontWeight: FontWeight.w900,
          color: color,
        ),
      ),
      ),
    );
  }

  Widget _balanceLine(String label, int value, {bool bold = false}) {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: 4),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Text(label),
          Text(
            "$value MMK",
            style: TextStyle(
              fontWeight: bold ? FontWeight.w900 : FontWeight.w600,
            ),
          ),
        ],
      ),
      ),
    );
  }

  Widget _card({required Widget child}) {
    return Container(
      padding: const EdgeInsets.all(14),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(18),
        boxShadow: [
          BoxShadow(
            blurRadius: 10,
            color: Colors.black.withOpacity(0.05),
            offset: const Offset(0, 6),
          )
        ],
      ),
      child: child,
    );
  }
}
